> 当前应用系统架构复杂，涵盖服务、网络、数据库、中间件等各个方面，涉及各种组件框架，要想确保应用服务稳定、高效的运行，必须对上述方面进行全方位的监控。

## 一、监控要关注的问题

- 指标类型、关键指标
- 高可用监控系统构建与存储选型
- 如何监控数据库、中间件如 MySQL、Redis、Kafka、ElasticSearch 等
- 如何监控 Kubernetes 
- 如何设置埋点、如何分析日志等
- 如何实现告警规则、屏蔽规则、抑制规则、订阅规则的管理
- 如何做到告警自愈、告警聚合收敛以及事件闭环

## 二、监控要覆盖的需求

核心：监控系统状态、及时感知问题。

- 通过监控了解数据趋势，知道系统在未来的某个时刻可能出问题，预知问题。
- 通过监控了解系统的水位情况，为 服务扩缩容提供数据支撑。 
- 通过监控来给系统把脉，感知到哪里需要优化，比如一些中间件参数的调优。 
- 通过监控来洞察业务，提供业务决策的数据依据，及时感知业务异常。

## 三、故障的生命周期

开始、发现、定位、止损、恢复、复盘

## 四、可观测性三大支柱

### 4.1 指标监控

指标监控领域的开源产品有 Zabbix、Prometheus

- 基础设施监控：服务器、虚拟机、网络设备等基础设施组件的性能数据，包括 CPU 使用率、内存占用、网络流量等。
- 应用程序监控： 性能指标，如响应时间、请求成功率、错误率等应用程序的性能指标。

### 4.2 日志

开源产品 ELK（ Elasticsearch、Logstash 和 Kibana ） 和 Loki，商业产品 Splunk 和 Datadog

- 操作系统日志：系统事件观测
- 接入层日志：域名、IP、URL 等访问率、成功率以及延迟等情况
- 服务运行日志：异常信息、调用堆栈等

### 4.3 分布式链路追踪（Tracing）

链路追踪产品：Skywalking、Jaeger、Zipkin 等

其思路是以请求串联上下游模块，实现追踪调用链路，监控链路性能，排查链路故障。

其基本原理就是在分布式应用的接口方法上设置一些观察点（类似快递中转站记录点），然后在入口节点给每个请求分配一个全局唯一的标识 TraceId（类似快递单号），当请求流经这些观察点时就会记录一行对应的链路日志（包含链路唯一标识，接口名称，时间戳，主机信息等）。最后通过 TraceId 将一次请求的所有链路日志进行组装，就可以还原出该次请求的链路轨迹

一个完整请求链路包含以下内容：

- 追踪ID（traceid）用于查出本次请求调用的所有服务，每一次服务调用的跨度ID（spanid）用来记录调用顺序
- 上游服务parenetid用来记录调用的层级关系
- 调用时间timestamp，把请求发出、接收、处理的时间都记录下来，计算业务处理耗时和网络耗时，然后用可视化界面展示出来每个调用链路，性能，故障
- 还可以记录一些其他信息，比如发起调用服务名称、被调服务名称、返回结果、IP、调用服务的名称等。
- 最后，我们再把相同spanid的信息合成一个大的span块，就完成了一个完整的调用链。



